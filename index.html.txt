<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas 2026 - Acceso Seguro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIGURACIN DE FIREBASE (Reemplaza con tus datos de la consola de Firebase)
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_PROYECTO.firebaseapp.com",
            projectId: "TU_PROYECTO",
            storageBucket: "TU_PROYECTO.appspot.com",
            messagingSenderId: "TU_ID",
            appId: "TU_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- LGICA DE INTERFAZ ---
        const authSection = document.getElementById('authSection');
        const appSection = document.getElementById('appSection');
        const userEmailSpan = document.getElementById('userEmail');

        // Escuchar cambios de sesi贸n
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authSection.classList.add('hidden');
                appSection.classList.remove('hidden');
                userEmailSpan.innerText = user.email;
                cargarDatos(user.uid);
            } else {
                authSection.classList.remove('hidden');
                appSection.classList.add('hidden');
            }
        });

        // Registro
        window.registrar = async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('pass').value;
            try {
                const cred = await createUserWithEmailAndPassword(auth, email, pass);
                await setDoc(doc(db, "usuarios", cred.user.uid), { movimientos: [] });
            } catch (e) { alert("Error: " + e.message); }
        };

        // Login
        window.login = async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('pass').value;
            try { await signInWithEmailAndPassword(auth, email, pass); } 
            catch (e) { alert("Credenciales incorrectas"); }
        };

        // Logout
        window.logout = () => signOut(auth);

        // --- LGICA DE FINANZAS ---
        let movimientos = [];

        async function cargarDatos(uid) {
            const docRef = doc(db, "usuarios", uid);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                movimientos = docSnap.data().movimientos || [];
                actualizarUI();
            }
        }

        window.subirMovimiento = async (e) => {
            e.preventDefault();
            const mov = {
                id: Date.now(),
                desc: document.getElementById('desc').value,
                monto: parseFloat(document.getElementById('monto').value),
                tipo: document.getElementById('tipo').value
            };
            
            const user = auth.currentUser;
            if (user) {
                const userRef = doc(db, "usuarios", user.uid);
                movimientos.push(mov);
                await updateDoc(userRef, { movimientos: arrayUnion(mov) });
                actualizarUI();
                e.target.reset();
            }
        };

        function actualizarUI() {
            const lista = document.getElementById('listaMovimientos');
            lista.innerHTML = '';
            let ingresos = 0, egresos = 0;

            movimientos.forEach(m => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-slate-50 transition';
                row.innerHTML = `<td class="p-4">${m.desc}</td><td class="p-4 capitalize text-sm">${m.tipo}</td>
                    <td class="p-4 text-right font-mono ${m.tipo === 'ingreso' ? 'text-green-500' : 'text-red-500'}">
                    ${m.tipo === 'ingreso' ? '+' : '-'}$${m.monto.toFixed(2)}</td>`;
                lista.appendChild(row);
                m.tipo === 'ingreso' ? ingresos += m.monto : egresos += m.monto;
            });

            document.getElementById('totalIngresos').innerText = `$${ingresos.toFixed(2)}`;
            document.getElementById('totalEgresos').innerText = `$${egresos.toFixed(2)}`;
            document.getElementById('balanceNeto').innerText = `$${(ingresos - egresos).toFixed(2)}`;
        }
    </script>
</head>
<body class="bg-slate-50 font-sans min-h-screen p-6">

    <div id="authSection" class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-lg mt-10">
        <h2 class="text-2xl font-bold mb-6 text-center text-slate-800"> Acceso Finanzas</h2>
        <input type="email" id="email" placeholder="Email" class="w-full p-2 mb-4 border rounded">
        <input type="password" id="pass" placeholder="Contrase帽a" class="w-full p-2 mb-6 border rounded">
        <div class="flex gap-2">
            <button onclick="login()" class="w-1/2 bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Entrar</button>
            <button onclick="registrar()" class="w-1/2 bg-slate-200 text-slate-700 py-2 rounded hover:bg-slate-300">Registrarse</button>
        </div>
    </div>

    <div id="appSection" class="max-w-4xl mx-auto hidden">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-slate-800"> Mis Finanzas 2026</h1>
                <p class="text-slate-500">Usuario: <span id="userEmail" class="font-bold"></span></p>
            </div>
            <button onclick="logout()" class="text-red-500 hover:underline">Cerrar Sesi贸n</button>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-500">
                <p class="text-sm text-slate-500 uppercase font-bold">Ingresos</p>
                <p id="totalIngresos" class="text-2xl font-bold text-green-500">$0.00</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-red-500">
                <p class="text-sm text-slate-500 uppercase font-bold">Egresos</p>
                <p id="totalEgresos" class="text-2xl font-bold text-red-500">$0.00</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-blue-500">
                <p class="text-sm text-slate-500 uppercase font-bold">Balance</p>
                <p id="balanceNeto" class="text-2xl font-bold text-slate-800">$0.00</p>
            </div>
        </div>

        <form onsubmit="subirMovimiento(event)" class="bg-white p-6 rounded-xl shadow-sm mb-8 grid grid-cols-1 md:grid-cols-4 gap-4">
            <input type="text" id="desc" placeholder="Descripci贸n" class="p-2 border rounded" required>
            <input type="number" id="monto" placeholder="Monto" step="0.01" class="p-2 border rounded" required>
            <select id="tipo" class="p-2 border rounded">
                <option value="ingreso">Ingreso (+)</option>
                <option value="egreso">Egreso (-)</option>
            </select>
            <button type="submit" class="bg-blue-600 text-white font-bold py-2 rounded">A帽adir</button>
        </form>

        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-slate-100"><tr class="text-slate-600"><th class="p-4">Descripci贸n</th><th class="p-4">Tipo</th><th class="p-4 text-right">Monto</th></tr></thead>
                <tbody id="listaMovimientos"></tbody>
            </table>
        </div>
    </div>
</body>
</html>